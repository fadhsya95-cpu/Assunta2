<!doctype html>
<html lang="ms">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PBD Digital</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@700;800&amp;display=swap" rel="stylesheet">
  <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            width: 100%;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            overflow-x: hidden;
        }

        .main-wrapper {
            height: 100%;
            width: 100%;
            overflow-y: auto;
        }

        .gradient-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .gradient-blob-1 {
            position: absolute;
            top: -10%;
            left: -10%;
            width: 40%;
            height: 40%;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 50%;
            filter: blur(120px);
        }

        .gradient-blob-2 {
            position: absolute;
            bottom: -10%;
            right: -10%;
            width: 40%;
            height: 40%;
            background: rgba(244, 63, 94, 0.1);
            border-radius: 50%;
            filter: blur(120px);
        }

        .content {
            position: relative;
            z-index: 10;
        }

        header {
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header-container {
            max-width: 100%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        @media (min-width: 768px) {
            .header-container {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }

        .header-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0 1rem;
        }

        .brand-icon {
            background: linear-gradient(135deg, #6366f1, #f43f5e);
            padding: 0.625rem;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .brand-text {
            font-size: 1.25rem;
            font-weight: 900;
            letter-spacing: -0.02em;
            text-transform: uppercase;
            font-style: italic;
        }

        .brand-accent {
            color: #a5f3fc;
        }

        nav {
            display: flex;
            gap: 0.25rem;
            padding: 0.25rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        @media (min-width: 1280px) {
            nav {
                flex-wrap: nowrap;
            }
        }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1.25rem;
            border-radius: 0.75rem;
            font-size: 0.625rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-btn.active {
            background: white;
            color: #1e293b;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .nav-btn:not(.active) {
            color: #94a3b8;
        }

        .nav-btn:not(.active):hover {
            color: white;
            background: rgba(255, 255, 255, 0.05);
        }

        main {
            max-width: 100%;
            margin: 0 auto;
            padding: 1.5rem;
            min-height: 100%;
        }

        .tab-section {
            display: none;
        }

        .tab-section.active {
            display: block;
        }

        .section-title {
            font-size: 2.25rem;
            font-weight: 900;
            letter-spacing: -0.02em;
            margin-bottom: 0.5rem;
            color: white;
        }

        .section-subtitle {
            color: #94a3b8;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 0.625rem;
            letter-spacing: 0.2em;
            margin-bottom: 2rem;
        }

        .grid-subjects {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .subject-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem;
            border-radius: 2.5rem;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .subject-card:hover {
            transform: scale(1.02);
            background: rgba(99, 102, 241, 0.1);
        }

        .subject-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: rgba(99, 102, 241, 0.2);
            border-radius: 0.5rem;
            font-size: 0.5625rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: #a5f3fc;
            margin-bottom: 1rem;
            width: fit-content;
        }

        .subject-name {
            font-size: 1.5rem;
            font-weight: 900;
            line-height: 1.25;
            margin-bottom: 0.25rem;
        }

        .subject-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 1rem;
        }

        .subject-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #94a3b8;
        }

        .subject-info-text {
            font-size: 0.625rem;
            font-weight: 900;
            text-transform: uppercase;
        }

        .subject-arrow {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .subject-card:hover .subject-arrow {
            background: #6366f1;
        }

        .record-header {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 2.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 1.5rem;
        }

        @media (min-width: 1280px) {
            .record-header {
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
            }
        }

        .record-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .record-icon {
            width: 3rem;
            height: 3rem;
            background: #6366f1;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.2);
        }

        .record-info h2 {
            font-size: 1.25rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: -0.02em;
        }

        .record-info p {
            font-size: 0.625rem;
            font-weight: 900;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.2em;
        }

        .record-controls {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            width: 100%;
        }

        @media (min-width: 640px) {
            .record-controls {
                flex-direction: row;
                width: auto;
            }
        }

        .select-control {
            padding: 0.875rem;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            color: white;
            font-weight: 900;
            font-size: 0.625rem;
            text-transform: uppercase;
            cursor: pointer;
            min-width: 250px;
        }

        .select-control:focus {
            outline: none;
            border-color: #6366f1;
        }

        .table-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 2.5rem;
            overflow: hidden;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.75rem;
        }

        thead {
            background: rgba(255, 255, 255, 0.05);
            color: #94a3b8;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        th {
            padding: 1.25rem;
            text-align: center;
            white-space: nowrap;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
        }

        th:first-child {
            text-align: center;
            width: 4rem;
            position: sticky;
            left: 0;
            background: #161e2e;
            z-index: 20;
        }

        th:nth-child(2) {
            text-align: left;
            min-width: 15rem;
            position: sticky;
            left: 4rem;
            background: #161e2e;
            z-index: 20;
            box-shadow: 5px 0 10px rgba(0, 0, 0, 0.2);
        }

        tbody tr {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.2s;
        }

        tbody tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        td {
            padding: 0.75rem;
            text-align: center;
        }

        td:first-child {
            position: sticky;
            left: 0;
            background: #0f172a;
            z-index: 10;
            text-align: center;
            font-size: 0.625rem;
            font-weight: 900;
            color: #64748b;
            width: 4rem;
        }

        tbody tr:hover td:first-child {
            background: #161e2e;
        }

        td:nth-child(2) {
            position: sticky;
            left: 4rem;
            background: #0f172a;
            z-index: 10;
            text-align: left;
            box-shadow: 5px 0 10px rgba(0, 0, 0, 0.2);
        }

        tbody tr:hover td:nth-child(2) {
            background: #161e2e;
        }

        .tp-btn {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 1rem;
            border: 2px solid;
            background: rgba(0, 0, 0, 0.3);
            color: #64748b;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }

        .tp-btn:hover {
            transform: scale(1.05);
        }

        .tp-btn.filled {
            background: #6366f1;
            border-color: #6366f1;
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        .tp-btn.filled-amber {
            background: #f59e0b;
            border-color: #f59e0b;
            color: white;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .tp-btn-large {
            width: 3rem;
            height: 3rem;
            border-radius: 1.5rem;
            font-size: 1.25rem;
            border: 2px solid;
        }

        .evidence-btn {
            width: 3rem;
            height: 3rem;
            border-radius: 1.5rem;
            border: 2px solid;
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
            color: #64748b;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }

        .evidence-btn:hover {
            color: white;
            border-color: rgba(255, 255, 255, 0.3);
        }

        .evidence-btn.has-data {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(12px);
            z-index: 600;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: #1e293b;
            border-radius: 3rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 28rem;
            width: 100%;
            animation: modal-in 0.3s ease-out;
        }

        @keyframes modal-in {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-large {
            max-width: 56rem;
        }

        .modal-header {
            padding: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 900;
            text-transform: uppercase;
            font-style: italic;
            color: white;
        }

        .modal-subtitle {
            font-size: 0.625rem;
            font-weight: 900;
            color: #a5f3fc;
            text-transform: uppercase;
            letter-spacing: 0.2em;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.05);
            border: none;
            color: white;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .modal-content {
            padding: 2rem;
        }

        .tp-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin: 2.5rem 0;
        }

        .tp-option {
            aspect-ratio: 1;
            border-radius: 1.25rem;
            border: 4px solid;
            background: rgba(255, 255, 255, 0.05);
            border-color: transparent;
            color: #64748b;
            font-weight: 900;
            font-size: 1.875rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tp-option:hover {
            border-color: rgba(255, 255, 255, 0.1);
        }

        .tp-option.active {
            background: #6366f1;
            border-color: #6366f1;
            color: white;
            transform: scale(1.1);
        }

        .btn-primary {
            width: 100%;
            padding: 1.25rem;
            background: #6366f1;
            border: none;
            border-radius: 1rem;
            color: white;
            font-weight: 900;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.2em;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 1rem;
        }

        .btn-primary:hover {
            background: #4f46e5;
        }

        .btn-secondary {
            width: 100%;
            padding: 1.25rem;
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-radius: 1rem;
            color: #94a3b8;
            font-weight: 900;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.2em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .settings-tabs {
            display: flex;
            gap: 0.5rem;
            padding: 0.25rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 2rem;
            width: fit-content;
            margin: 0 auto 2.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .settings-tab-btn {
            padding: 0.75rem 2rem;
            border-radius: 1.5rem;
            border: none;
            background: transparent;
            color: #94a3b8;
            font-weight: 900;
            font-size: 0.625rem;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .settings-tab-btn.active {
            background: white;
            color: #1e293b;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .settings-content {
            display: none;
        }

        .settings-content.active {
            display: block;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .settings-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem;
            border-radius: 2.5rem;
        }

        .settings-card h4 {
            font-weight: 900;
            font-size: 0.75rem;
            text-transform: uppercase;
            margin-bottom: 1.5rem;
            letter-spacing: 0.2em;
        }

        .settings-card-indigo h4 {
            color: #a5f3fc;
        }

        .settings-card-rose h4 {
            color: #f87171;
        }

        .input-group {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        input, textarea, select {
            flex: 1;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            color: white;
            font-weight: 700;
            font-size: 0.875rem;
            text-transform: uppercase;
            outline: none;
            transition: all 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            border-color: #6366f1;
        }

        textarea {
            resize: vertical;
            min-height: 150px;
            font-family: 'Plus Jakarta Sans', sans-serif;
        }

        .add-btn {
            padding: 1rem;
            background: #6366f1;
            border: none;
            color: white;
            border-radius: 0.75rem;
            cursor: pointer;
            font-weight: 900;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .add-btn:hover {
            background: #4f46e5;
        }

        .item-list {
            space: 0.5rem;
        }

        .item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 1.25rem;
            margin-bottom: 0.5rem;
            font-weight: 900;
            font-size: 0.75rem;
        }

        .delete-btn {
            background: transparent;
            border: none;
            color: #64748b;
            cursor: pointer;
            transition: all 0.3s;
            padding: 0;
        }

        .delete-btn:hover {
            color: #f43f5e;
        }

        .empty-state {
            padding: 6rem 1.5rem;
            text-align: center;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .empty-state-icon {
            font-size: 3rem;
            color: rgba(99, 102, 241, 0.2);
            margin-bottom: 1.5rem;
        }

        .empty-state-text {
            color: #64748b;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.2em;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .analysis-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem;
            border-radius: 2.5rem;
        }

        .analysis-card label {
            display: block;
            font-size: 0.625rem;
            font-weight: 900;
            text-transform: uppercase;
            color: #a5f3fc;
            margin-bottom: 0.75rem;
            letter-spacing: 0.2em;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2.5rem;
            border-radius: 3rem;
            min-height: 400px;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            gap: 1rem;
        }

        .chart-bar {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .bar {
            width: 100%;
            background: linear-gradient(135deg, #6366f1, #a78bfa);
            border-radius: 0.5rem 0.5rem 0 0;
            min-height: 2rem;
            transition: all 0.3s;
        }

        .bar:hover {
            filter: brightness(1.2);
        }

        .bar-label {
            font-size: 0.625rem;
            font-weight: 900;
            text-transform: uppercase;
            color: #94a3b8;
            text-align: center;
            width: 100%;
        }

        .bar-value {
            font-size: 0.75rem;
            font-weight: 900;
            color: white;
            margin-top: 0.25rem;
        }

        .custom-scrollbar::-webkit-scrollbar {
            height: 8px;
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 10px;
        }

        @media (max-width: 640px) {
            .section-title {
                font-size: 1.75rem;
            }

            .grid-subjects {
                grid-template-columns: 1fr;
            }

            .nav-btn span {
                display: none;
            }

            table {
                font-size: 0.65rem;
            }

            th, td {
                padding: 0.5rem;
            }

            .tp-btn {
                width: 2rem;
                height: 2rem;
                font-size: 0.75rem;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="gradient-bg">
   <div class="gradient-blob-1"></div>
   <div class="gradient-blob-2"></div>
  </div>
  <div class="main-wrapper custom-scrollbar">
   <header>
    <div class="header-container">
     <div class="header-brand">
      <div class="brand-icon">
       üìã
      </div>
      <div class="brand-text">
       PBD <span class="brand-accent">DIGITAL</span>
      </div>
     </div>
     <nav><button class="nav-btn active" data-tab="dashboard">üìä Utama</button> <button class="nav-btn" data-tab="record_tp">üìù Rekod TP</button> <button class="nav-btn" data-tab="analysis">üìà Analisis</button> <button class="nav-btn" data-tab="settings">‚öôÔ∏è Tetapan</button>
     </nav>
    </div>
   </header>
   <main class="content"><!-- DASHBOARD TAB -->
    <section id="dashboard" class="tab-section active">
     <div style="max-width: 1280px; margin: 0 auto;">
      <h2 class="section-title">Pilih Subjek</h2>
      <p class="section-subtitle">Sila pilih kelas dan subjek untuk mula merekod</p>
      <div class="grid-subjects" id="subjectGrid"></div>
     </div>
    </section><!-- RECORD TP TAB -->
    <section id="record_tp" class="tab-section">
     <div style="max-width: 100%; margin: 0 auto;">
      <div class="record-header">
       <div class="record-title">
        <div class="record-icon">
         üìã
        </div>
        <div class="record-info">
         <h2 id="recordTitle">Rekod PBD</h2>
         <p id="recordClass">Sila pilih subjek</p>
        </div>
       </div>
       <div class="record-controls"><select class="select-control" id="subjectSelect"></select> <select class="select-control" id="topicFilter" style="background: rgba(99, 102, 241, 0.1); border-color: rgba(99, 102, 241, 0.3); color: #a5f3fc;"></select>
       </div>
      </div>
      <div class="table-container" id="tableContainer" style="display: none;">
       <table id="recordTable"></table>
      </div>
      <div id="emptyRecordState" class="empty-state">
       <div class="empty-state-icon">
        üìö
       </div>
       <p class="empty-state-text">Sila pilih subjek di Dashboard</p>
      </div>
     </div>
    </section><!-- ANALYSIS TAB -->
    <section id="analysis" class="tab-section">
     <div style="max-width: 1280px; margin: 0 auto;">
      <div class="analysis-grid">
       <div class="analysis-card"><label>Subjek Analisis</label> <select class="select-control" id="analysisSubject"></select>
       </div>
       <div class="analysis-card"><label>Topik</label> <select class="select-control" id="analysisTopic"></select>
       </div>
      </div>
      <div class="chart-container" id="chartContainer">
       <div class="empty-state-text" style="width: 100%; text-align: center;">
        Pilih subjek untuk melihat analisis
       </div>
      </div>
     </div>
    </section><!-- SETTINGS TAB -->
    <section id="settings" class="tab-section">
     <div class="settings-tabs" id="settingsTabs"><button class="settings-tab-btn active" data-manage-tab="classes_subjects">Kelas &amp; Subjek</button> <button class="settings-tab-btn" data-manage-tab="students">Senarai Murid</button> <button class="settings-tab-btn" data-manage-tab="curriculum">Tajuk &amp; SP</button>
     </div><!-- Classes & Subjects -->
     <div id="classes_subjects" class="settings-content active">
      <div class="settings-grid">
       <div class="settings-card settings-card-indigo">
        <h4>Daftar Kelas</h4>
        <div class="input-group"><input type="text" id="newClassName" placeholder="cth: 6 INOVATIF"> <button class="add-btn">‚ûï</button>
        </div>
        <div class="item-list" id="classList"></div>
       </div>
       <div class="settings-card settings-card-rose">
        <h4>Daftar Subjek</h4><select class="select-control" id="classSelectSubj" style="margin-bottom: 0.5rem;"></select>
        <div class="input-group"><input type="text" id="newSubjectName" placeholder="cth: BAHASA MELAYU"> <button class="add-btn">‚ûï</button>
        </div>
        <div class="item-list" id="subjectList"></div>
       </div>
      </div>
     </div><!-- Students -->
     <div id="students" class="settings-content">
      <div class="settings-card" style="max-width: 500px; margin: 0 auto;">
       <h4 style="color: #a5f3fc;">Daftar Murid Pukal</h4><select class="select-control" id="classSelectStudent" style="margin-bottom: 1rem;"></select> <textarea id="bulkStudentNames" placeholder="Satu nama satu baris..."></textarea> <button class="btn-primary">Simpan Senarai</button>
      </div>
     </div><!-- Curriculum -->
     <div id="curriculum" class="settings-content">
      <div class="settings-grid">
       <div>
        <div class="settings-card settings-card-indigo">
         <h4>Tambah Tajuk</h4><select class="select-control" id="subjectSelectTopic" style="margin-bottom: 0.5rem;"></select>
         <div class="input-group"><input type="text" id="newTopicName" placeholder="Nama Tajuk"> <button class="add-btn">‚ûï</button>
         </div>
        </div>
        <div class="item-list" id="topicList"></div>
       </div>
       <div class="settings-card settings-card-indigo" style="height: fit-content;">
        <h4>Tambah SP</h4><select class="select-control" id="topicSelectSp" style="margin-bottom: 0.75rem;"></select> <input type="text" id="newSpCode" placeholder="Kod SP (cth: 1.1.1)" style="margin-bottom: 0.75rem;"> <textarea id="newSpDesc" placeholder="Huraian SP" style="margin-bottom: 1rem;"></textarea> <button class="btn-primary">Simpan SP</button>
       </div>
      </div>
     </div>
    </section>
   </main>
  </div><!-- MODALS -->
  <div id="spInfoModal" class="modal-overlay">
   <div class="modal">
    <div class="modal-header">
     <div><span id="spModalCode" style="display: inline-block; padding: 0.375rem 0.75rem; background: #6366f1; border-radius: 9999px; font-size: 0.625rem; font-weight: 900; text-transform: uppercase; letter-spacing: 0.2em;"></span>
     </div><button class="close-btn">ÔøΩÔøΩÔøΩ</button>
    </div>
    <div class="modal-content">
     <h3 class="modal-title">Standard Pembelajaran</h3>
     <p id="spModalDesc" style="color: #cbd5e1; font-weight: 700; line-height: 1.5; margin-top: 1rem;"></p>
    </div>
   </div>
  </div>
  <div id="editTpModal" class="modal-overlay">
   <div class="modal">
    <div class="modal-content">
     <h4 id="editTpStudentName" style="font-size: 1.5rem; font-weight: 900; color: white; text-transform: uppercase; margin-bottom: 2rem;"></h4>
     <div class="tp-grid" id="tpGrid"></div><button class="btn-secondary">Batal</button>
    </div>
   </div>
  </div>
  <div id="evidenceModal" class="modal-overlay">
   <div class="modal modal-large">
    <div class="modal-header">
     <div>
      <div class="modal-title">
       Bukti Pembelajaran
      </div>
      <p id="evidenceSubtitle" class="modal-subtitle"></p>
     </div><button class="close-btn">‚úï</button>
    </div>
    <div class="modal-content">
     <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
      <div style="aspect-ratio: 1; background: rgba(0, 0, 0, 0.3); border: 2px dashed rgba(255, 255, 255, 0.1); border-radius: 1rem; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #64748b; cursor: pointer; transition: all 0.3s;" class="image-placeholder">
       üì∑ <span style="font-size: 0.5rem; font-weight: 900; text-transform: uppercase; margin-top: 0.5rem;">Lampiran 1</span>
      </div>
      <div style="aspect-ratio: 1; background: rgba(0, 0, 0, 0.3); border: 2px dashed rgba(255, 255, 255, 0.1); border-radius: 1rem; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #64748b; cursor: pointer; transition: all 0.3s;" class="image-placeholder">
       üì∑ <span style="font-size: 0.5rem; font-weight: 900; text-transform: uppercase; margin-top: 0.5rem;">Lampiran 2</span>
      </div>
      <div style="aspect-ratio: 1; background: rgba(0, 0, 0, 0.3); border: 2px dashed rgba(255, 255, 255, 0.1); border-radius: 1rem; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #64748b; cursor: pointer; transition: all 0.3s;" class="image-placeholder">
       üì∑ <span style="font-size: 0.5rem; font-weight: 900; text-transform: uppercase; margin-top: 0.5rem;">Lampiran 3</span>
      </div>
      <div style="aspect-ratio: 1; background: rgba(0, 0, 0, 0.3); border: 2px dashed rgba(255, 255, 255, 0.1); border-radius: 1rem; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #64748b; cursor: pointer; transition: all 0.3s;" class="image-placeholder">
       üì∑ <span style="font-size: 0.5rem; font-weight: 900; text-transform: uppercase; margin-top: 0.5rem;">Lampiran 4</span>
      </div>
     </div><textarea id="evidenceNote" placeholder="Masukkan catatan am untuk subjek ini..." style="margin-bottom: 1rem;"></textarea> <button class="btn-primary">Simpan Bukti</button>
    </div>
   </div>
  </div>
  <script>
        // Data structure
        let appData = {
            classes: [],
            subjects: [],
            students: [],
            topics: [],
            spData: [],
            tpRecords: {},
            manualOverrides: {},
            evidenceRecords: {}
        };

        let currentState = {
            selectedSubject: null,
            viewMode: 'all',
            editingTp: null,
            evidenceModal: null
        };

        // Initialize Data SDK
        const dataHandler = {
            onDataChanged(data) {
                // Process data from SDK
                data.forEach(record => {
                    const parsed = JSON.parse(record.data || '{}');
                    switch(record.type) {
                        case 'class':
                            appData.classes = appData.classes.filter(c => c.id !== record.id);
                            appData.classes.push({id: record.id, ...parsed});
                            break;
                        case 'subject':
                            appData.subjects = appData.subjects.filter(s => s.id !== record.id);
                            appData.subjects.push({id: record.id, ...parsed});
                            break;
                        case 'student':
                            appData.students = appData.students.filter(s => s.id !== record.id);
                            appData.students.push({id: record.id, ...parsed});
                            break;
                        case 'topic':
                            appData.topics = appData.topics.filter(t => t.id !== record.id);
                            appData.topics.push({id: record.id, ...parsed});
                            break;
                        case 'sp':
                            appData.spData = appData.spData.filter(sp => sp.id !== record.id);
                            appData.spData.push({id: record.id, ...parsed});
                            break;
                        case 'tp_record':
                            appData.tpRecords[record.id] = parsed;
                            break;
                        case 'manual_override':
                            appData.manualOverrides[record.id] = parsed;
                            break;
                        case 'evidence':
                            appData.evidenceRecords[record.id] = parsed;
                            break;
                    }
                });
                updateUI();
            }
        };

        async function initializeDataSDK() {
            if (window.dataSdk) {
                const result = await window.dataSdk.init(dataHandler);
                if (result.isOk) {
                    console.log('Data SDK initialized');
                } else {
                    console.error('Failed to initialize Data SDK');
                }
            }
        }

        // Save data to SDK
        async function saveData(type, id, data) {
            if (window.dataSdk) {
                const exists = Object.values(appData[type === 'class' ? 'classes' : type === 'subject' ? 'subjects' : type === 'student' ? 'students' : type === 'topic' ? 'topics' : type === 'sp' ? 'spData' : 'tpRecords']).some(item => item.id === id);
                
                const record = {
                    type: type,
                    data: JSON.stringify(data),
                    createdAt: new Date().toISOString()
                };

                if (exists) {
                    await window.dataSdk.update({__backendId: id, ...record});
                } else {
                    await window.dataSdk.create(record);
                }
            }
        }

        async function deleteData(type, id) {
            if (window.dataSdk) {
                const items = type === 'class' ? appData.classes : type === 'subject' ? appData.subjects : type === 'student' ? appData.students : type === 'topic' ? appData.topics : type === 'sp' ? appData.spData : [];
                const item = items.find(i => i.id === id);
                if (item && item.__backendId) {
                    await window.dataSdk.delete({__backendId: item.__backendId, type, data: JSON.stringify(item)});
                }
            }
        }

        // UI Functions
        function updateUI() {
            renderDashboard();
            renderRecordTP();
            renderAnalysis();
            renderSettings();
        }

        function renderDashboard() {
            const grid = document.getElementById('subjectGrid');
            grid.innerHTML = appData.subjects.map(subject => {
                const cls = appData.classes.find(c => c.id === subject.classId);
                const studentCount = appData.students.filter(s => s.classId === subject.classId).length;
                return `
                    <button class="subject-card" onclick="selectSubject('${subject.id}')">
                        <div>
                            <span class="subject-badge">${cls?.name || 'Tiada Kelas'}</span>
                            <h3 class="subject-name">${subject.name}</h3>
                        </div>
                        <div class="subject-footer">
                            <div class="subject-info">
                                <span>üë•</span>
                                <span class="subject-info-text">${studentCount} Murid</span>
                            </div>
                            <div class="subject-arrow">‚Üí</div>
                        </div>
                    </button>
                `;
            }).join('');
        }

        function selectSubject(subjectId) {
            const subject = appData.subjects.find(s => s.id === subjectId);
            currentState.selectedSubject = subject;
            currentState.viewMode = 'all';
            switchTab('record_tp');
            renderRecordTP();
        }

        function renderRecordTP() {
            const titleEl = document.getElementById('recordTitle');
            const classEl = document.getElementById('recordClass');
            const subjectSelect = document.getElementById('subjectSelect');
            const topicFilter = document.getElementById('topicFilter');
            const tableContainer = document.getElementById('tableContainer');
            const emptyState = document.getElementById('emptyRecordState');
            const table = document.getElementById('recordTable');

            // Always populate subject select with all available subjects
            subjectSelect.innerHTML = `<option value="">-- Pilih Subjek --</option>` + 
                appData.subjects.map(s => {
                    const cls = appData.classes.find(c => c.id === s.classId);
                    return `<option value="${s.id}">${cls?.name || 'Tiada'} ‚Ä¢ ${s.name}</option>`;
                }).join('');

            if (currentState.selectedSubject) {
                subjectSelect.value = currentState.selectedSubject.id;
                const cls = appData.classes.find(c => c.id === currentState.selectedSubject.classId);
                titleEl.textContent = currentState.selectedSubject.name;
                classEl.textContent = cls?.name || 'Tiada Kelas';

                // Populate topic filter
                const subjects_topics = appData.topics.filter(t => t.subjectId === currentState.selectedSubject.id);
                topicFilter.innerHTML = `<option value="all">Papar Keseluruhan (Semua Tajuk)</option>` +
                    subjects_topics.map(t => `<option value="${t.id}">${t.name}</option>`).join('');

                // Build table
                const filteredTopics = currentState.viewMode === 'all' ? 
                    subjects_topics : 
                    subjects_topics.filter(t => t.id === currentState.viewMode);

                const classStudents = appData.students.filter(s => s.classId === currentState.selectedSubject.classId).sort((a, b) => a.name.localeCompare(b.name));

                let tableHTML = `<thead><tr>
                    <th style="width: 4rem;">Bil</th>
                    <th style="min-width: 15rem;">Nama Murid</th>
                    <th style="width: 6rem; background: rgba(245, 158, 11, 0.1);">TP LENGKAP</th>`;

                // Add topic headers
                filteredTopics.forEach(topic => {
                    const topicSps = appData.spData.filter(sp => sp.topicId === topic.id);
                    tableHTML += `<th colspan="${topicSps.length + 1}" style="background: rgba(99, 102, 241, 0.05);">${topic.name}</th>`;
                });

                tableHTML += `<th style="width: 6rem; background: rgba(16, 185, 129, 0.1);">Bukti</th></tr>`;

                // Subheaders
                tableHTML += `<tr style="background: rgba(255, 255, 255, 0.05);">
                    <th></th><th></th><th></th>`;

                filteredTopics.forEach(topic => {
                    const topicSps = appData.spData.filter(sp => sp.topicId === topic.id);
                    tableHTML += `<th colspan="${topicSps.length}" style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">Standard Pembelajaran</th>`;
                    tableHTML += `<th style="background: rgba(99, 102, 241, 0.1);">TP Tajuk</th>`;
                });

                tableHTML += `<th></th></tr>`;

                // SP Code headers
                tableHTML += `<tr style="background: rgba(255, 255, 255, 0.05);">
                    <th></th><th></th><th></th>`;

                filteredTopics.forEach(topic => {
                    const topicSps = appData.spData.filter(sp => sp.topicId === topic.id);
                    topicSps.forEach(sp => {
                        tableHTML += `<th><button onclick="openSpInfo('${sp.id}')" style="background: rgba(255, 255, 255, 0.05); border: none; color: #94a3b8; padding: 0.5rem; border-radius: 0.5rem; cursor: pointer; font-weight: 900; font-size: 0.625rem;">${sp.code} ‚ÑπÔ∏è</button></th>`;
                    });
                    tableHTML += `<th></th>`;
                });

                tableHTML += `<th></th></tr></thead><tbody>`;

                // Student rows
                classStudents.forEach((student, idx) => {
                    tableHTML += `<tr>
                        <td>${idx + 1}</td>
                        <td>${student.name}</td>`;

                    // Overall TP
                    const overallTp = calculateOverallTp(student.id, currentState.selectedSubject.id);
                    tableHTML += `<td><button class="tp-btn tp-btn-large ${overallTp > 0 ? 'filled-amber' : ''}" onclick="openEditTp('subject', '${student.id}', '${currentState.selectedSubject.id}')">${overallTp || '-'}</button></td>`;

                    // Topic cells
                    filteredTopics.forEach(topic => {
                        const topicSps = appData.spData.filter(sp => sp.topicId === topic.id);
                        topicSps.forEach(sp => {
                            const spTp = appData.tpRecords[`${student.id}_sp_${sp.id}`]?.tp || 0;
                            tableHTML += `<td><button class="tp-btn ${spTp > 0 ? 'filled' : ''}" onclick="openEditTp('sp', '${student.id}', '${sp.id}')">${spTp || '-'}</button></td>`;
                        });

                        const topicTp = calculateTopicTp(student.id, topic.id);
                        tableHTML += `<td><button class="tp-btn tp-btn-large ${topicTp > 0 ? 'filled' : ''}" onclick="openEditTp('topic', '${student.id}', '${topic.id}')">${topicTp || '-'}</button></td>`;
                    });

                    // Evidence button
                    const hasEvidence = appData.evidenceRecords[`${student.id}_${currentState.selectedSubject.id}`];
                    tableHTML += `<td><button class="evidence-btn ${hasEvidence ? 'has-data' : ''}" onclick="openEvidenceModal('${student.id}', '${currentState.selectedSubject.id}')">üì∑</button></td>`;

                    tableHTML += `</tr>`;
                });

                tableHTML += `</tbody>`;
                table.innerHTML = tableHTML;
                tableContainer.style.display = 'block';
                emptyState.style.display = 'none';
            } else {
                tableContainer.style.display = 'none';
                emptyState.style.display = 'block';
            }
        }

        function calculateTopicTp(studentId, topicId) {
            const override = appData.manualOverrides[`${studentId}_topic_${topicId}`]?.tp || 0;
            if (override) return override;

            const topicSps = appData.spData.filter(sp => sp.topicId === topicId);
            const records = topicSps.map(sp => appData.tpRecords[`${studentId}_sp_${sp.id}`]?.tp || 0).filter(tp => tp > 0);

            if (records.length === 0) return 0;
            return Math.round(records.reduce((a, b) => a + b, 0) / records.length);
        }

        function calculateOverallTp(studentId, subjectId) {
            const override = appData.manualOverrides[`${studentId}_subject_${subjectId}`]?.tp || 0;
            if (override) return override;

            const subjectTopics = appData.topics.filter(t => t.subjectId === subjectId);
            if (subjectTopics.length === 0) return 0;

            const values = subjectTopics.map(t => calculateTopicTp(studentId, t.id)).filter(tp => tp > 0);
            return values.length > 0 ? Math.round(values.reduce((a, b) => a + b, 0) / values.length) : 0;
        }

        function renderAnalysis() {
            const subjSelect = document.getElementById('analysisSubject');
            const topicSelect = document.getElementById('analysisTopic');
            const chartContainer = document.getElementById('chartContainer');

            subjSelect.innerHTML = `<option value="">Pilih Subjek</option>` + 
                appData.subjects.map(s => `<option value="${s.id}">${s.name}</option>`).join('');

            // Update chart when selection changes
            const updateChart = () => {
                const selectedSubj = appData.subjects.find(s => s.id === subjSelect.value);
                if (!selectedSubj) {
                    chartContainer.innerHTML = `<div class="empty-state-text" style="width: 100%; text-align: center;">Pilih subjek untuk melihat analisis</div>`;
                    return;
                }

                const topicOption = topicSelect.value;
                topicSelect.innerHTML = `<option value="overall">Analisis Keseluruhan</option>` +
                    appData.topics.filter(t => t.subjectId === selectedSubj.id).map(t => `<option value="${t.id}">${t.name}</option>`).join('');
                
                if (topicOption && topicOption !== 'overall') {
                    topicSelect.value = topicOption;
                }

                // Calculate distribution
                const classStudents = appData.students.filter(s => s.classId === selectedSubj.classId);
                const counts = {1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0};

                classStudents.forEach(student => {
                    let tp;
                    if (topicSelect.value === 'overall') {
                        tp = calculateOverallTp(student.id, selectedSubj.id);
                    } else {
                        tp = calculateTopicTp(student.id, topicSelect.value);
                    }
                    if (tp >= 1 && tp <= 6) counts[tp]++;
                });

                const colors = ['#FF4E50', '#FC913A', '#F9D423', '#2ECC71', '#3498DB', '#9B59B6'];
                const maxCount = Math.max(...Object.values(counts), 1);

                chartContainer.innerHTML = `<div class="chart-bar" style="width: 100%; display: grid; grid-template-columns: repeat(6, 1fr); gap: 1rem; align-items: flex-end;">
                    ${Object.entries(counts).map(([tp, count]) => `
                        <div class="chart-bar">
                            <div class="bar" style="background: ${colors[tp - 1]}; height: ${(count / maxCount) * 300}px;"></div>
                            <span class="bar-label">TP ${tp}</span>
                            <span class="bar-value">${count}</span>
                        </div>
                    `).join('')}
                </div>`;
            };

            subjSelect.addEventListener('change', updateChart);
            topicSelect.addEventListener('change', updateChart);
        }

        function renderSettings() {
            // Classes
            document.getElementById('classList').innerHTML = appData.classes.map(c => `
                <div class="item-row">
                    <span>${c.name}</span>
                    <button class="delete-btn" onclick="deleteItem('class', '${c.id}')">üóëÔ∏è</button>
                </div>
            `).join('');

            // Class selects
            const classOptions = appData.classes.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            document.getElementById('classSelectSubj').innerHTML = `<option value="">Pilih Kelas</option>${classOptions}`;
            document.getElementById('classSelectStudent').innerHTML = `<option value="">Pilih Kelas</option>${classOptions}`;
            document.getElementById('subjectSelectTopic').innerHTML = `<option value="">Pilih Subjek</option>` + appData.subjects.map(s => `<option value="${s.id}">${s.name}</option>`).join('');

            // Subjects
            document.getElementById('subjectList').innerHTML = appData.subjects.map(s => {
                const cls = appData.classes.find(c => c.id === s.classId);
                return `
                    <div class="item-row">
                        <div>
                            <span>${s.name}</span>
                            <span style="margin-left: 0.5rem; font-size: 0.625rem; color: #64748b;">(${cls?.name})</span>
                        </div>
                        <button class="delete-btn" onclick="deleteItem('subject', '${s.id}')">üóëÔ∏è</button>
                    </div>
                `;
            }).join('');

            // Topics
            document.getElementById('topicList').innerHTML = appData.topics.map(t => `
                <div class="item-row" style="margin-bottom: 0.5rem;">
                    <span>${t.name}</span>
                    <button class="delete-btn" onclick="deleteItem('topic', '${t.id}')">üóëÔ∏è</button>
                </div>
            `).join('');

            document.getElementById('topicSelectSp').innerHTML = `<option value="">Pilih Tajuk</option>` + appData.topics.map(t => `<option value="${t.id}">${t.name}</option>`).join('');
        }

        // Modal functions
        function openSpInfo(spId) {
            const sp = appData.spData.find(s => s.id === spId);
            if (sp) {
                document.getElementById('spModalCode').textContent = sp.code;
                document.getElementById('spModalDesc').textContent = sp.desc;
                document.getElementById('spInfoModal').classList.add('active');
            }
        }

        function openEditTp(type, studentId, itemId) {
            let currentValue = 0;
            if (type === 'sp') {
                currentValue = appData.tpRecords[`${studentId}_sp_${itemId}`]?.tp || 0;
            } else if (type === 'topic') {
                currentValue = calculateTopicTp(studentId, itemId);
            } else {
                currentValue = calculateOverallTp(studentId, itemId);
            }

            const student = appData.students.find(s => s.id === studentId);
            document.getElementById('editTpStudentName').textContent = student.name;

            let grid = '';
            for (let i = 1; i <= 6; i++) {
                grid += `<button class="tp-option ${i === currentValue ? 'active' : ''}" onclick="saveTp('${type}', '${studentId}', '${itemId}', ${i})">${i}</button>`;
            }
            document.getElementById('tpGrid').innerHTML = grid;
            document.getElementById('editTpModal').classList.add('active');
        }

        async function saveTp(type, studentId, itemId, value) {
            if (type === 'sp') {
                appData.tpRecords[`${studentId}_sp_${itemId}`] = {tp: value};
                await saveData('tp_record', `${studentId}_sp_${itemId}`, {tp: value});
            } else {
                const key = `${studentId}_${type === 'topic' ? 'topic' : 'subject'}_${itemId}`;
                appData.manualOverrides[key] = {tp: value};
                await saveData('manual_override', key, {tp: value});
            }
            document.getElementById('editTpModal').classList.remove('active');
            renderRecordTP();
        }

        function openEvidenceModal(studentId, subjectId) {
            const student = appData.students.find(s => s.id === studentId);
            const subject = appData.subjects.find(s => s.id === subjectId);
            const evidence = appData.evidenceRecords[`${studentId}_${subjectId}`] || {};

            document.getElementById('evidenceSubtitle').textContent = `${subject.name} ‚Ä¢ ${student.name}`;
            document.getElementById('evidenceNote').value = evidence.note || '';
            document.getElementById('evidenceModal').classList.add('active');

            document.querySelector('#evidenceModal .btn-primary').onclick = async () => {
                const note = document.getElementById('evidenceNote').value;
                const key = `${studentId}_${subjectId}`;
                appData.evidenceRecords[key] = {note: note};
                await saveData('evidence', key, {note: note});
                document.getElementById('evidenceModal').classList.remove('active');
                renderRecordTP();
            };
        }

        function deleteItem(type, id) {
            if (confirm('Anda pasti mahu memadam?')) {
                if (type === 'class') {
                    appData.classes = appData.classes.filter(c => c.id !== id);
                } else if (type === 'subject') {
                    appData.subjects = appData.subjects.filter(s => s.id !== id);
                } else if (type === 'topic') {
                    appData.topics = appData.topics.filter(t => t.id !== id);
                }
                deleteData(type, id);
                updateUI();
            }
        }

        // Event listeners
        document.querySelectorAll('[data-tab]').forEach(btn => {
            btn.addEventListener('click', () => {
                switchTab(btn.dataset.tab);
            });
        });

        document.querySelectorAll('[data-manage-tab]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('[data-manage-tab]').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.settings-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(btn.dataset.manageTab).classList.add('active');
            });
        });

        document.querySelectorAll('.close-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                btn.closest('.modal-overlay').classList.remove('active');
            });
        });

        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });

        // Form submissions
        document.addEventListener('click', (e) => {
            if (e.target.matches('#classList ~ .add-btn') || 
                (e.target.closest('.settings-card-indigo') && e.target.matches('.add-btn') && !e.target.closest('#classList').closest('.settings-card-rose'))) {
                const input = document.getElementById('newClassName');
                if (input.value) {
                    const id = 'class_' + Date.now();
                    appData.classes.push({id, name: input.value.toUpperCase()});
                    saveData('class', id, {name: input.value.toUpperCase()});
                    input.value = '';
                    renderSettings();
                }
            }
        });

        document.addEventListener('click', (e) => {
            if (e.target.closest('.settings-card-rose') && e.target.matches('.add-btn')) {
                const select = document.getElementById('classSelectSubj');
                const input = document.getElementById('newSubjectName');
                if (input.value && select.value) {
                    const id = 'subject_' + Date.now();
                    appData.subjects.push({id, name: input.value.toUpperCase(), classId: select.value});
                    saveData('subject', id, {name: input.value.toUpperCase(), classId: select.value});
                    input.value = '';
                    renderSettings();
                }
            }
        });

        document.querySelector('#students .btn-primary').addEventListener('click', () => {
            const classId = document.getElementById('classSelectStudent').value;
            const names = document.getElementById('bulkStudentNames').value;
            if (classId && names) {
                names.split('\n').filter(n => n.trim()).forEach(name => {
                    const id = 'student_' + Date.now() + Math.random();
                    appData.students.push({id, name: name.toUpperCase(), classId});
                    saveData('student', id, {name: name.toUpperCase(), classId});
                });
                document.getElementById('bulkStudentNames').value = '';
                renderSettings();
            }
        });

        document.addEventListener('click', (e) => {
            if (e.target.closest('#curriculum .settings-card-indigo:first-child') && e.target.matches('.add-btn')) {
                const select = document.getElementById('subjectSelectTopic');
                const input = document.getElementById('newTopicName');
                if (input.value && select.value) {
                    const id = 'topic_' + Date.now();
                    appData.topics.push({id, name: input.value.toUpperCase(), subjectId: select.value});
                    saveData('topic', id, {name: input.value.toUpperCase(), subjectId: select.value});
                    input.value = '';
                    renderSettings();
                }
            }
        });

        document.querySelector('#curriculum .settings-card-indigo:last-child .btn-primary').addEventListener('click', () => {
            const topicId = document.getElementById('topicSelectSp').value;
            const code = document.getElementById('newSpCode').value;
            const desc = document.getElementById('newSpDesc').value;
            if (topicId && code && desc) {
                const id = 'sp_' + Date.now();
                appData.spData.push({id, code, desc, topicId});
                saveData('sp', id, {code, desc, topicId});
                document.getElementById('newSpCode').value = '';
                document.getElementById('newSpDesc').value = '';
                renderSettings();
            }
        });

        document.getElementById('subjectSelect').addEventListener('change', (e) => {
            if (e.target.value) {
                const subject = appData.subjects.find(s => s.id === e.target.value);
                currentState.selectedSubject = subject;
                currentState.viewMode = 'all';
                renderRecordTP();
            }
        });

        document.getElementById('topicFilter').addEventListener('change', (e) => {
            currentState.viewMode = e.target.value;
            renderRecordTP();
        });

        function switchTab(tabName) {
            document.querySelectorAll('.tab-section').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        }

        // Initialize with sample data
        async function initializeWithSampleData() {
            await initializeDataSDK();
            
            // Check if data already exists
            if (appData.classes.length === 0) {
                // Add sample classes
                const sampleClasses = [
                    {id: 'class_1', name: '6 INOVATIF'},
                    {id: 'class_2', name: '6 CEMERLANG'},
                    {id: 'class_3', name: '6 BERJAYA'}
                ];
                
                // Add sample subjects
                const sampleSubjects = [
                    {id: 'subject_1', name: 'BAHASA MELAYU', classId: 'class_1'},
                    {id: 'subject_2', name: 'MATEMATIK', classId: 'class_1'},
                    {id: 'subject_3', name: 'SAINS', classId: 'class_1'},
                    {id: 'subject_4', name: 'BAHASA MELAYU', classId: 'class_2'},
                    {id: 'subject_5', name: 'MATEMATIK', classId: 'class_2'}
                ];
                
                // Add sample students
                const sampleStudents = [
                    {id: 'student_1', name: 'AHMAD BIN HASSAN', classId: 'class_1'},
                    {id: 'student_2', name: 'SITI NURHALIZA', classId: 'class_1'},
                    {id: 'student_3', name: 'MOHAMMAD AMIN', classId: 'class_1'},
                    {id: 'student_4', name: 'FATIMAH ZAHRA', classId: 'class_1'},
                    {id: 'student_5', name: 'ABDUL KARIM', classId: 'class_1'},
                    {id: 'student_6', name: 'NURUL IZZAH', classId: 'class_2'},
                    {id: 'student_7', name: 'HASSAN IBRAHIM', classId: 'class_2'},
                    {id: 'student_8', name: 'ZAINAB MOHD', classId: 'class_2'}
                ];
                
                // Add sample topics
                const sampleTopics = [
                    {id: 'topic_1', name: 'MEMAHAMI TEKS NARATIF', subjectId: 'subject_1'},
                    {id: 'topic_2', name: 'KEMAHIRAN MENDENGAR', subjectId: 'subject_1'},
                    {id: 'topic_3', name: 'NOMBOR DAN OPERASI', subjectId: 'subject_2'},
                    {id: 'topic_4', name: 'PENGUKURAN', subjectId: 'subject_2'},
                    {id: 'topic_5', name: 'ORGANISMA DAN KEHIDUPAN', subjectId: 'subject_3'},
                    {id: 'topic_6', name: 'STRUKTUR DAN FUNGSI', subjectId: 'subject_3'}
                ];
                
                // Add sample SP (Standard Pembelajaran)
                const sampleSp = [
                    {id: 'sp_1', code: '1.1.1', desc: 'Memahami unsur-unsur naratif yang terdapat dalam teks', topicId: 'topic_1'},
                    {id: 'sp_2', code: '1.1.2', desc: 'Mengaplikasikan teknik membaca untuk memahami ayat demi ayat', topicId: 'topic_1'},
                    {id: 'sp_3', code: '1.2.1', desc: 'Mendengar dan memahami cerita pendek', topicId: 'topic_2'},
                    {id: 'sp_4', code: '1.2.2', desc: 'Merumuskan maklumat yang didengar', topicId: 'topic_2'},
                    {id: 'sp_5', code: '2.1.1', desc: 'Mengenal pasti dan menyatakan nilai tempat nombor hingga 1 juta', topicId: 'topic_3'},
                    {id: 'sp_6', code: '2.1.2', desc: 'Melakukan operasi asas dengan pelbagai strategi', topicId: 'topic_3'},
                    {id: 'sp_7', code: '2.2.1', desc: 'Mengenal unit panjang, jisim, dan isi padu', topicId: 'topic_4'},
                    {id: 'sp_8', code: '2.2.2', desc: 'Menukar unit ukuran', topicId: 'topic_4'},
                    {id: 'sp_9', code: '3.1.1', desc: 'Memahami konsep sel sebagai unit kehidupan', topicId: 'topic_5'},
                    {id: 'sp_10', code: '3.1.2', desc: 'Mengenal pasti ciri-ciri makhluk hidup', topicId: 'topic_5'},
                    {id: 'sp_11', code: '3.2.1', desc: 'Mengenal pasti organ manusia dan fungsinya', topicId: 'topic_6'},
                    {id: 'sp_12', code: '3.2.2', desc: 'Mempelajari sistem organ dalam badan manusia', topicId: 'topic_6'}
                ];
                
                // Add sample TP records
                const sampleTpRecords = [
                    {id: 'student_1_sp_1', tp: 3},
                    {id: 'student_1_sp_2', tp: 4},
                    {id: 'student_1_sp_3', tp: 2},
                    {id: 'student_1_sp_4', tp: 3},
                    {id: 'student_2_sp_1', tp: 5},
                    {id: 'student_2_sp_2', tp: 5},
                    {id: 'student_2_sp_3', tp: 4},
                    {id: 'student_2_sp_4', tp: 4},
                    {id: 'student_3_sp_1', tp: 2},
                    {id: 'student_3_sp_2', tp: 2},
                    {id: 'student_3_sp_3', tp: 2},
                    {id: 'student_3_sp_4', tp: 1},
                    {id: 'student_4_sp_1', tp: 4},
                    {id: 'student_4_sp_2', tp: 4},
                    {id: 'student_4_sp_3', tp: 3},
                    {id: 'student_4_sp_4', tp: 3},
                    {id: 'student_5_sp_1', tp: 3},
                    {id: 'student_5_sp_2', tp: 3},
                    {id: 'student_5_sp_3', tp: 2},
                    {id: 'student_5_sp_4', tp: 3}
                ];
                
                // Save all sample data
                for (let cls of sampleClasses) {
                    appData.classes.push(cls);
                    if (window.dataSdk) {
                        await window.dataSdk.create({type: 'class', data: JSON.stringify({name: cls.name}), createdAt: new Date().toISOString()});
                    }
                }
                
                for (let subj of sampleSubjects) {
                    appData.subjects.push(subj);
                    if (window.dataSdk) {
                        await window.dataSdk.create({type: 'subject', data: JSON.stringify({name: subj.name, classId: subj.classId}), createdAt: new Date().toISOString()});
                    }
                }
                
                for (let student of sampleStudents) {
                    appData.students.push(student);
                    if (window.dataSdk) {
                        await window.dataSdk.create({type: 'student', data: JSON.stringify({name: student.name, classId: student.classId}), createdAt: new Date().toISOString()});
                    }
                }
                
                for (let topic of sampleTopics) {
                    appData.topics.push(topic);
                    if (window.dataSdk) {
                        await window.dataSdk.create({type: 'topic', data: JSON.stringify({name: topic.name, subjectId: topic.subjectId}), createdAt: new Date().toISOString()});
                    }
                }
                
                for (let sp of sampleSp) {
                    appData.spData.push(sp);
                    if (window.dataSdk) {
                        await window.dataSdk.create({type: 'sp', data: JSON.stringify({code: sp.code, desc: sp.desc, topicId: sp.topicId}), createdAt: new Date().toISOString()});
                    }
                }
                
                for (let record of sampleTpRecords) {
                    appData.tpRecords[record.id] = {tp: record.tp};
                    if (window.dataSdk) {
                        await window.dataSdk.create({type: 'tp_record', data: JSON.stringify({tp: record.tp}), createdAt: new Date().toISOString()});
                    }
                }
                
                updateUI();
            }
        }

        // Initialize
        initializeWithSampleData();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cbcd8ee2462c0c2',t:'MTc3MDczOTUyMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>